<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard</title>
  <link rel="stylesheet" href="../css/style.css" />
</head>
<body>
  <div class="login-wrapper">
    <div class="login-card">
      <h2>Welcome, <span id="userRole"></span></h2>

      <div id="salesPanel" class="panel hidden">
        <a href="create-sale.html"><button>Create Sale</button></a>
      </div>
<div id="adminPanel" class="panel hidden">
  <a href="create-sale.html"><button>Create Sale</button></a>
  <a href="manage-products.html"><button>Manage Products</button></a>
  <a href="#"><button>Manage Users</button></a>

  <h3 style="margin-top: 30px;">Add New Product</h3>
  <form id="productForm">
    <input type="text" id="productName" placeholder="Product Name" required />
    <input type="number" id="productPrice" placeholder="Price (€)" required />
    <input type="number" id="productQuantity" placeholder="Quantity" required />
    <button type="submit">Add Product</button>
  </form>
  <p id="productMessage" class="message"></p>
</div>


      <button onclick="logout()">Logout</button>
    </div>
  </div>

  <script>
    const user = JSON.parse(localStorage.getItem("loggedInUser"));
    if (!user || !user.role) {
      window.location.href = "login.html";
    } else {
      document.getElementById("userRole").textContent = user.role;

      if (user.role === "admin") {
        document.getElementById("adminPanel").classList.remove("hidden");
      } else {
        document.getElementById("salesPanel").classList.remove("hidden");
      }
    }

    function logout() {
      localStorage.removeItem("loggedInUser");
      window.location.href = "login.html";
    }

    // ✅ Handle Add Product Form
    document.getElementById("productForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const name = document.getElementById("productName").value;
      const price = parseFloat(document.getElementById("productPrice").value);
      const quantity = parseInt(document.getElementById("productQuantity").value);
      const msg = document.getElementById("productMessage");

      const res = await fetch("/api/products", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ name, price, quantity })
      });

      const data = await res.json();

      if (res.ok) {
        msg.textContent = "Product added successfully!";
        msg.style.color = "green";
        this.reset();
      } else {
        msg.textContent = data.error || "Failed to add product.";
        msg.style.color = "red";
      }
    });

    console.log("User role:", user.role);

  </script>
</body>
</html>
