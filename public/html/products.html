<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manage Products</title>
    <link rel="stylesheet" href="../css/products.css" />
  </head>
  <body>
    <h1>Manage Products</h1>

    <div id="notAdmin" style="display: none; color: red">
      ‚ùå You are not authorized to view this page.
    </div>

    <div id="productSection" style="display: none">
      <form id="productForm">
        <input type="text" id="name" placeholder="Product name" required />
        <input type="number" id="price" placeholder="Price" required />
        <input type="number" id="quantity" placeholder="Quantity" required />
        <button type="submit">Add Product</button>
      </form>

      <p id="message"></p>
      <section id="imageUploadSection" style="margin-top: 16px">
        <h3>Product Image</h3>

        <div style="margin-bottom: 8px">
          <label for="productSelect">Select product:</label>
          <select id="productSelect"></select>
        </div>

        <input type="file" id="product-image" accept="image/*" />
        <button id="upload-image-btn" type="button">Upload Image</button>

        <div style="margin-top: 8px">
          <img
            id="product-image-preview"
            alt="Preview"
            style="max-width: 180px; display: none"
          />
        </div>

        <p id="uploadMsg" style="color: green"></p>
      </section>

      <h2>Product List</h2>
      <table border="1" id="productTable">
        <thead>
          <tr>
            <th>Image</th>
            <th>Name</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <!-- Fullscreen image modal -->
    <div id="imageModal">
      <img id="modalImg" src="" alt="Product Preview" />
    </div>

    <form id="importForm" enctype="multipart/form-data">
      <input type="file" id="csvFile" name="file" accept=".csv" required />
      <button type="submit">Import CSV</button>
    </form>
    <pre id="importResult"></pre>
    <script src="../js/products.js" defer></script>

    <script>
      document
        .getElementById("importForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const f = document.getElementById("csvFile").files[0];
          if (!f) return;

          const fd = new FormData();
          fd.append("file", f);

          const res = await fetch("/api/products/import", {
            method: "POST",
            body: fd,
          });
          const json = await res.json();
          document.getElementById("importResult").textContent = JSON.stringify(
            json,
            null,
            2,
          );
        });
    </script>
  </body>
</html>
